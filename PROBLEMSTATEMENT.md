# **تعریف مسئله**

در مرحله دوم هکاتون می‌خوایم یک AI Shopping Assistant درست کنیم که به درخواست‌های مختلف کاربرها جواب بده. هر کاربری ممکنه با یک هدف خاصی با ایجنت ارتباط برقرار کنه.  
مثلا دنبال جواب یک سوال باشه یا دنبال یک محصول خاص بگرده یا… شما باید یک دستیار خرید هوشمند درست کنید که  از طریق چت با کاربر تعامل کنه و در نهایت کمک کنه که سریع‌تر به هدفش برسه.  
وظیفه‌ی دیپلوی کردن پروژه کاملا بر عهده‌ی خودتون هست و محدودیتی روی زبان برنامه‌نویسی یا تکنولوژی‌های استفاده شده وجود نداره. به هر نفر یک کد هدیه‌ی یک ملیون تومانی همروش داده میشه که می‌تونه کدش رو توی کلاسترهای همروش دیپلوی کنه.

## **دیتای مسابقه**

دیتای مسابقه رو میتونید از [اینجا دانلود](https://drive.google.com/file/d/1W4mSI33IbeKkWztK3XmE05F7m4tNYDYu/view?usp=sharing) کنید. در ادامه ستون‌های جداول توضیح داده شده است.

### **جدول جستجو‌ها (Searches)**

این جدول لاگ هر صفحه از نتایج جستجو را در خود ذخیره می‌کند.

| نام ستون | توضیحات |
| ----: | ----: |
| id | **شناسه یکتای هر صفحه از نتایج جستجو.** برای اتصال لاگ‌های دیگر (مثل بازدید و کلیک) به این جستجو استفاده می‌شود. |
| uid | **شناسه یکتای یک جستجو (شامل تمام صفحات).** این شناسه برای تمام صفحات یک جستجوی خاص، یکسان است. (برابر id صفحه صفر) |
| query | عبارت جستجو که توسط کاربر وارد شده است. |
| page | شماره صفحه در نتایج جستجو (صفحه اول از اندیس 0 شروع می‌شود). |
| timestamp | زمان دقیق ثبت لاگ جستجو در دیتابیس به وقت UTC. |
| session\_id | شناسه نشست (session) کاربر  |
| `result_base_product_rks` | لیستی از کدهای (base\_random\_key) محصولات پایه‌ای که در نتایج به کاربر نمایش داده شده‌اند. |
| category\_id | شناسه دسته‌بندی که کاربر جستجوی خود را به آن محدود کرده است. مقدار 0 به معنی عدم انتخاب دسته‌بندی است. |
| category\_brand\_boosts | لیستی از دسته‌بندی‌ها و برندهایی که در این جستجو امتیاز بالاتری (boost) در رتبه‌بندی گرفته‌اند. |

### **جدول مشاهده بیس (Base Views)**

این جدول هر بار که کاربر بر روی یکی از بیس‌های موجود در نتایج جستجو کلیک می‌کند یک لاگ ثبت می‌کند.

| نام ستون | توضیحات |
| ----: | ----: |
| id | شناسه یکتای هر رویداد بازدید از صفحه محصول پایه. |
| search\_id | شناسه صفحه‌ی جستجویی که این بازدید از آنجا آمده است (متصل به id در search). |
| `base_product_rk` | کلید رندوم (random key) محصول پایه‌ای که مشاهده شده است. |
| timestamp | زمان دقیق ثبت لاگ بازدید در دیتابیس به وقت UTC. |

### **جدول کلیک نهایی (Final click)**

این جدول اطلاعات مربوط به کلیک‌های نهایی کاربر روی محصولات فروشگاه‌ها را ثبت می‌کند.

| نام ستون  | توضیحات |
| ----: | ----: |
| id | شناسه یکتا برای هر رویداد کلیک. |
| base\_view\_id | شناسه‌ای که این کلیک را به یک بازدید از صفحه محصول (base\_view) متصل می‌کند. |
| shop\_id | شناسه فروشگاهی که آیتم کلیک‌شده به آن تعلق دارد. |
| timestamp | زمان دقیق وقوع کلیک به وقت UTC. |

### **جدول محصولات پایه (Base Products)**

| نام ستون  | توضیحات |
| ----: | ----: |
| random\_key | کلید شناسایی یکتای محصول پایه |
| persian\_name | نام فارسی محصول |
| english\_name | نام انگلیسی محصول |
| category\_id | شناسه دسته‌بندی محصول |
| brand\_id | شناسه برند محصول |
| extra\_features | ویژگی‌های اضافی محصول (JSON) |
| image\_url | آدرس تصویر محصول |
| members | لیستی از رندوم کی محصولات (کلید خارجی به جدول members) |

### **جدول محصولات فروشگاه‌ها (Members)**

| نام ستون  | توضیحات |
| ----: | ----: |
| random\_key | شناسه یکتای محصول در یک فروشگاه |
| base\_random\_key | کلیدی که این محصول را به محصول پایه متصل می‌کند |
| shop\_id | شناسه فروشگاه |
| price | قیمت محصول در این فروشگاه |

### **جدول فروشگاه‌ها (Shops)**

| نام ستون | توضیحات  |
| ----: | ----: |
| id | شناسه فروشگاه |
| city\_id | شناسه شهر محل فروشگاه |
| score | امتیاز فروشگاه در ترب که از روی نتیجه پیگیری سفارش فروشگاه در ترب ساخته شده و عددی بین صفر تا پنج است. |
| has\_warranty | آیا فروشگاه ضمانت ترب دارد |

### **جدول دسته‌بندی‌ها (Categories)**

| نام ستون | توضیحات |
| ----: | ----: |
| id | شناسه دسته‌بندی |
| title | عنوان دسته‌بندی |
| parent\_id | شناسه دسته بندی پدر، دسته‌بندی‌ها یک ساختار سلسله مراتبی دارن. که هر دسته یک پدر داره و ممکنه چندین فرزند داشته باشه. اگر پدری نداشته باشد، این فیلد مقدار \-۱ دارد. |

### **جدول برندها (Brands)**

| نام ستون | توضیحات |
| ----: | ----: |
| id | شناسه برند. |
| title | عنوان برند |

### **جدول شهرها (cities)**

| نام ستون | توضیحات |
| ----: | ----: |
| id | شناسه شهر |
| name | عنوان شهر |

## **فرمت API**

ایجنت شما باید اندپوینت زیر رو پیاده‌سازی کرده باشه. 

### **اندپوینت /chat**

این اندپوینت راه ارتباط کاربران با agent شما است. Judge مسابقه از طریق متد POST به این اندپوینت ریکوست میز‌ند.

**فرمت درخواست (Request)**  
درخواست ارسالی به این اندپوینت باید در قالب یک آبجکت JSON با ساختار زیر باشد:

**ساختار اصلی درخواست:**

| JSON |
| :---- |
| {  "chat\_id": "string",  "messages": \[    {      "type": "string",      "content": "string"    }  \]} |

**توضیحات فیلدها:**

* فیلد chat\_id فرمت (string, **required**): شناسه منحصر به فرد برای هر سشن چت که برای شناسایی و پیگیری چت استفاده می‌شود.  
* فیلد messages فرمت (array of objects, **required**): لیستی از پیام‌های ارسالی توسط کاربر. هر پیام یک آبجکت با ساختار زیر است:  
  * فیلد type فرمت (string, **required**): نوع پیام را مشخص می‌کند. این فیلد تنها می‌تواند یکی از دو مقدار زیر را داشته باشد:  
    * "text": برای پیام‌های متنی.  
    * "image": برای پیام‌های تصویری.  
  * فیلد content فرمت (string, **required**): محتوای پیام.  
    * اگر type برابر با "text" باشد، این فیلد حاوی متن پیام است.  
    * اگر type برابر با "image" باشد، این فیلد حاوی یک رشته **base64-encoded** از تصویر است.

**فرمت پاسخ (Response)**  
پاسخ این اندپوینت در قالب یک آبجکت JSON با ساختار زیر خواهد بود:

**ساختار اصلی پاسخ:**

| JSON |
| :---- |
| {  "message": "string",  "base\_random\_keys": \["string"\],  "member\_random\_keys": \["string"\]} |

**توضیحات فیلدها:**

* فیلد message فرمت (string, *optional*): پاسخ متنی که باید به کاربر نمایش داده شود. این فیلد می‌تواند در برخی موارد null باشد.  
* فیلد base\_random\_keys فرمت (array of strings, *optional*): لیستی از کلیدهای تصادفی مربوط به محصولات پایه که ممکن است در پاسخ استفاده شوند. این فیلد می‌تواند null باشد. حداکثر طول لیست باید ۱۰ باشد. (وقتی کاربر به دنبال یک محصول خاص هست باید این فیلد پر باشد.)  
* فیلد member\_random\_keys فرمت (array of strings, *optional*): لیستی از کلیدهای تصادفی مربوط به محصولات member. این فیلد نیز می‌تواند null باشد.  حداکثر طول لیست باید ۱۰ باشد. (وقتی کاربر به دنبال یک فروشنده خاص هست باید این فیلد پر باشد.)

### **مثال از اندپوینت /chat**

**نمونه درخواست (Request)**

| JSON |
| :---- |
| {  "chat\_id": "a1b2c3d4-e5f6-7890-1234-567890abcdef",  "messages": \[    {      "type": "text",      "content": "سلام، یک گوشی آیفون ۱۶ پرومکس میخوام"    }  \]} |

**نمونه پاسخ (Response)**

سیستم پس از پردازش درخواست، یک پیام تأیید به همراه کلیدهای تصادفی مربوط به محصول پایه برمی‌گرداند.

| JSON |
| :---- |
| {  "message": "این گوشی رو به شما پیشنهاد میکنم.",  "base\_random\_keys": \["awsome-gooshi-rk"\],  "member\_random\_keys": null} |

## **نحوه ارزیابی**

هر کس باید کد خودش رو به صورت کامل دیپلوی کنه و یک دامنه برای ما ارسال کنه. دامنه باید باید یک اندپوینت chat داشته باشه که با توضیحات بالا کار کنه.  
این مسابقه یک public leaderboard و یک private leaderboard داره. شما در طول مسابقه می‌تونید از طریق [پنل مسابقه](http://turbo.torob.com/login) درخواست بدید که به دامنه‌ای که در اختیار ما گذاشتید ریکوست بزنیم و نحوه پاسخ‌دهی دستیار شما به این ریکوست‌ها public leaderboard رو درست میکنه.  
ریکوست‌هایی که روز آخر مسابقه (۴ مهر) به سرویس شما میزنیم متفاوت هست (سناریو سوالات مشابه ولی ورودی دقیقا یکسان نیست.) و نتیجه این ریکوست‌هاست که private leaderboard رو تعیین میکنه.  
همچنین برای اینکه در داوری باشید لازم است کارهای زیر را انجام دهید:

- ساخت و ارسال یک ویدیو ۵ دقیقه شامل معماری، چالش‌ها، امکانات پیاده‌سازی شده و … در انتهای پروژه  
- دسترسی به ریپو کدهای خودتون در همگیت به اکانت recruiter@torob.ir

در ادامه با توجه به نتایج این داوری تعدادی از تیم‌ها به مرحله مصاحبه راه پیدا خواهند کرد. در مرحله مصاحبه آنلاین یک مصاحبه ۳۰ دقیقه‌ای با نفرات برتر انجام میدیم و در نهایت نفرات برتر نهایی تعیین میشوند.

## **سناریو‌های ارزیابی**

سناریو‌های در نظر گرفته شده برای مسابقه به شرح زیر است. در ابتدای مسابقه فقط judge برای سناریو یک فعال هست و در ادامه به مرور judge برای سوالات دیگر هم فعال شده و اطلاع‌رسانی انجام خواهد شد.

### **سناریو صفر**

این سناریو برای اطمینان از اتصال صحیح جاج با سرویس طراحی شده است. 

| ورودی (Request) | خروجی (Response) |
| ----- | ----- |
| { "chat\_id": "sanity-check-ping", "messages": \[ { "type": "text", "content": "ping" } \] } | { "message": "pong", "base\_random\_keys": null, "member\_random\_keys": null } |
| { "chat\_id": "sanity-check-base-key", "messages": \[ { "type": "text", "content": "return base random key: 123e4567-e89b-12d3-a456-426614174000" } \] } | { "message": null, "base\_random\_keys": \["123e4567-e89b-12d3-a456-426614174000"\], "member\_random\_keys": null } |
| { "chat\_id": "sanity-check-member-key", "messages": \[ { "type": "text", "content": "return member random key: abc-def-123" } \] } | { "message": null, "base\_random\_keys": null, "member\_random\_keys": \["abc-def-123"\] } |

**نکته:** فرمت ورودی دقیقا به شکل گفته شده و فرمت خروجی دقیقا به شکل گفته شده ولی مقادیر random\_key ممکن است متفاوت باشد.  
**تاریخ فعال‌سازی:‌** ۲۴ شهریور  
**امتیاز: ۵۰**

### **سناریو یک**

**ورودی:** کاربر دنبال یک محصول مشخص از ترب میگرده (کوئری کاربر رو میشه دقیقا به یک بیس ترب مپ کرد.)  
**خروجی:** در یک مرحله‌ رندوم کی بیس در خروجی داده بشه. (در قسمت base\_random\_keys)  
**مثال:** 

| ورودی (Request) | خروجی (Response) |
| ----- | ----- |
| { "chat\_id": "q1-abc", "messages": \[ { "type": "text", "content": "لطفاً دراور چهار کشو (کد D14) را برای من تهیه کنید." } \] } | { "message": null, "base\_random\_keys": \["bmubxu"\], "member\_random\_keys": null } |

**نکته:** در این سوال base\_random\_keys باید حداکثر یک نتیجه داشته باشد.  
**تاریخ فعال‌سازی:‌** ۲۵ شهریور  
**امتیاز: ۱۵۰**

### **سناریو دو**

**ورودی:** کاربر دنبال یک ویژگی خاص از یک محصول مشخص از ترب میگرده (کوئری کاربر رو میشه دقیقا به یک بیس ترب مپ کرد.)  
**خروجی:** در یک مرحله‌ مقدار ویژگی مورد نظر برای اون محصول رو برگردونیم. (در قسمت message)  
**مثال:**

| ورودی (Request) | خروجی (Response) |
| ----- | ----- |
| { "chat\_id": "q2-abc", "messages": \[ { "type": "text", "content": "عرض پارچه تریکو جودون 1/30 لاکرا گردباف نوریس به رنگ زرد طلایی چقدر است؟" } \] } | { "message": "1.18 meter", "base\_random\_keys": null, "member\_random\_keys": null } |

**نکته:** لازم نیست دقیقا مقدار 1.18 متر در پاسخ برگردونده بشه. مقادیر "1.18 متر" و "عرض پارچه ۱.۱۸ متر است." و "۱۱۸ سانتی‌متر" هم قابل قبول است.  
**تاریخ فعال‌سازی:‌** ۲۵ شهریور  
**امتیاز: ۱۵۰**

### **سناریو سه**

**ورودی:** کاربر سوالی در مورد فروشنده‌های یک بیس مشخص از ترب داره. (کوئری کاربر رو میشه دقیقا به یک بیس ترب مپ کرد.)  
**خروجی:** در یک مرحله‌ سوالی که کاربر پرسیده رو جواب بده. (در قسمت message)  
**مثال:**

| ورودی (Request) | خروجی (Response) |
| ----- | ----- |
| { "chat\_id": "q3-abc", "messages": \[ { "type": "text", "content": "کمترین قیمت در این پایه برای گیاه طبیعی بلک گلد بنسای نارگل کد ۰۱۰۸ چقدر است؟" } \] } | { "message": "275000", "base\_random\_keys": null, "member\_random\_keys": null } |

**نکته:** خروجی باید قابل پارس کردن به این int یا float باشد. (با توجه به خواسته سوال)  
**تاریخ فعال‌سازی:‌** ۲۵ شهریور  
**امتیاز: ۲۰۰**

### **سناریو چهار**

**هدف:** کاربر دنبال یک محصول خاص میگرده ولی کوئری اولیه رو نمیشه به یک محصول خاص مربوط کرد دستیار باید با پرسش و پاسخ با کاربر کمک کنه به هدفش برسه.  
**خروجی:** نهایت ۵ مرحله فرصت داره با کاربر چت کنه در نهایت دستیار باید محصول مورد نظر رو در قسمت member\_random\_keys بزاره. (هر زمان این کار رو انجام بده judge فرآیند رو خاتمه میده.)  
**مثال:**

| ورودی (Request) | خروجی (Response) |
| ----- | ----- |
| { "chat\_id": "q4-abc", "messages": \[ { "type": "text", "content": "ن دنبال یه میز تحریر هستم که برای کارهای روزمره و نوشتن مناسب باشه. می‌خواستم بدونم آیا می‌تونید به من کمک کنید تا یه فروشنده خوب پیدا کنم؟ ممنون می‌شم اگه راهنمایی کنید." } \] } | { "message": null, "base\_random\_keys": null, "member\_random\_keys": \["xpjtgd"\]} |

**نکته:‌** همونطور که مشخص هست از کوئری اولیه نمیشه مستقیم به اون محصول رسید ولی با توجه به اسپک‌های محصولاتی که تو دسته بخاری برقی هست ایجنت باید یک سری سوال بپرسه که در نهایت به محصول مورد نظر برسه. مثلا فن‌دار میخوای یا بی فن چه توانی میخوای چه برندی میخوای و … دقت بکنید که در این سوال judge میدونه که چی میخواد ولی این رو در پرامپت اولیه مستقیما نمیگه.  
**نکته ۲:** در نهایت در این سوال member\_random\_keys باید حداکثر یک نتیجه داشته باشد.  
**تاریخ فعال‌سازی:‌** ۲۷ شهریور  
**امتیاز: ۳۰۰**

### **سناریو پنج**

**ورودی:** مقایسه دو یا چند بیس مشخص (کوئری کاربر رو میشه دقیقا به دو تا بیس مپ کرد.) با توجه به یک کاربرد مشخص  
**خروجی:** در یک مرحله‌ باید دقیقا بگه که کدوم محصول بهتره و چرا؟   
**مثال:**

| ورودی (Request) | خروجی (Response) |
| ----- | ----- |
| { "chat\_id": "q5-abc", "messages": \[ { "type": "text", "content": "کدام یک از این ماگ‌های خرید ماگ-لیوان هندوانه فانتزی و کارتونی کد 1375 یا ماگ لته خوری سرامیکی با زیره کد 741 دارای سبک کارتونی و فانتزی بوده و برای کودکان یا نوجوانان مناسب‌تر است؟" } \] } | { "message": "چون طراحی کارتونی و فانتزی دارد که برای افراد جوان‌تر یا کسانی که از محیط‌های شاد و غیررسمی لذت می‌برند، جذابیت بیشتری دارد.", "base\_random\_keys": \["hhtgaa"\], "member\_random\_keys": null } |

**نکته:** در نهایت در این سوال base\_random\_keys باید حداکثر یک نتیجه داشته باشد. و دلیل انتخاب باید در message شرح داده شده باشه.  
**تاریخ فعال‌سازی:‌** ۲۷ شهریور  
**امتیاز: ۲۰۰**

### **سناریو شش**

**هدف:** کاربر دنبال این هست که بدونه آبجکت اصلی موجود در یک عکس چی هست؟ ممکن هست چندین شیء در تصویر موجود باشد اما با توجه اطلاعات محصول باید به آن پاسخ دهید  
**خروجی:** آبجکت و یا موضوع اصلی موجود در عکس رو به کاربر بگیم. با llm خروجی شما بررسی میشود.  
**مثال:**

| ورودی (Request) | خروجی (Response) |
| ----- | ----- |
| { "chat\_id": "q5-abc", "messages": \[ { "type": "text", "content": "شیء و مفهوم اصلی در تصویر چیست؟" }, { "type": "image", "content": "data:image/jpeg;base64,\<image-base64\>" } \] } | { "message": "پتو", "base\_random\_keys": null, "member\_random\_keys": null } |

[لینک](https://image.torob.com/base/images/7i/p6/7ip6Yt4qrJWb_ra8.jpg) تصویر در مثال بالا  
برای انکود کردن تصاویر به شکل زیر عمل شده:

| import base64 import requests  def get\_base64\_encoded\_image(image\_url: str):    response \= requests.get(image\_url)    response.raise\_for\_status()    image\_data \= response.content    base64\_image \= base64.b64encode(image\_data).decode("utf-8")    assert base64.b64decode(base64\_image) \== image\_data    return base64\_image  |
| ----- |

**تاریخ فعال‌سازی:‌** ۲۷ شهریور  
**امتیاز: ۱۰۰**

### **سناریو هفت**

**هدف:** کاربر دنبال بیس مربوط به یک عکس خاص هست (عکس به یک بیس خاص مپ میشه.)  
**خروجی:** رندوم کی بیس در خروجی داده بشه. (در قسمت base\_random\_keys)  
**تاریخ فعال‌سازی:‌** ۲۷ شهریور  
**مثال:**

| ورودی (Request) | خروجی (Response) |
| ----- | ----- |
| { "chat\_id": "q5-abc", "messages": \[ { "type": "text", "content": "یک محصول مرتبط مناسب با تصویر به من بدهید." }, { "type": "image", "content": "data:image/jpeg;base64,\<image-base64\>" } \] } | { "message": null, "base\_random\_keys":\["vdbkdf"\], "member\_random\_keys": null } |

نمونه تصویر:  
**![][image1]**  
**امتیاز: ۲۵۰**

### **سناریو هشت**

**هدف:** کاربر یک کوئری که به محصول خاصی از ترب مپ میشه رو میده و محصولات مشابهش رو میخواد.  
**خروجی:** لیست رندوم کی محصولات مشابه با کوئری کاربر رو بهش میدیم. (در قسمت base\_random\_keys)  
**تاریخ فعال‌سازی:‌** ۲۹ شهریور (در صورت نیاز)  
**امتیاز: ۳۰۰**

### **سناریو نه**

**هدف:** کاربر یک کوئری که به چندین محصول از ترب مپ میشه رو میده و باید رنکینگ خوبی از محصولات رو به کاربر برگردونیم.  
**خروجی:** رنکینگ برتر رو بهش نمایش میدیم.  (در قسمت base\_random\_keys)  
**تاریخ فعال‌سازی:‌** ۲۹ شهریور (در صورت نیاز)  
**امتیاز: ۳۰۰**